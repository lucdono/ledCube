/*
 * 3D LED CUBE
 *
 * Copyright (C) 2021 Luca D'Onofrio.
 *
 * This file is part of LEDCube Project
 *
 * LEDCube is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * LEDCube is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#include "cube_math.h"

int16_t sin_table[A_360] = { 0, 175, 349, 523, 698, 872, 1045, 1219, 1392, 1564,
		1736, 1908, 2079, 2250, 2419, 2588, 2756, 2924, 3090, 3256, 3420, 3584,
		3746, 3907, 4067, 4226, 4384, 4540, 4695, 4848, 5000, 5150, 5299, 5446,
		5592, 5736, 5878, 6018, 6157, 6293, 6428, 6561, 6691, 6820, 6947, 7071,
		7193, 7314, 7431, 7547, 7660, 7771, 7880, 7986, 8090, 8192, 8290, 8387,
		8480, 8572, 8660, 8746, 8829, 8910, 8988, 9063, 9135, 9205, 9272, 9336,
		9397, 9455, 9511, 9563, 9613, 9659, 9703, 9744, 9781, 9816, 9848, 9877,
		9903, 9925, 9945, 9962, 9976, 9986, 9994, 9998, 10000, 9998, 9994, 9986,
		9976, 9962, 9945, 9925, 9903, 9877, 9848, 9816, 9781, 9744, 9703, 9659,
		9613, 9563, 9511, 9455, 9397, 9336, 9272, 9205, 9135, 9063, 8988, 8910,
		8829, 8746, 8660, 8572, 8480, 8387, 8290, 8192, 8090, 7986, 7880, 7771,
		7660, 7547, 7431, 7314, 7193, 7071, 6947, 6820, 6691, 6561, 6428, 6293,
		6157, 6018, 5878, 5736, 5592, 5446, 5299, 5150, 5000, 4848, 4695, 4540,
		4384, 4226, 4067, 3907, 3746, 3584, 3420, 3256, 3090, 2924, 2756, 2588,
		2419, 2250, 2079, 1908, 1736, 1564, 1392, 1219, 1045, 872, 698, 523,
		349, 175, 0, -175, -349, -523, -698, -872, -1045, -1219, -1392, -1564,
		-1736, -1908, -2079, -2250, -2419, -2588, -2756, -2924, -3090, -3256,
		-3420, -3584, -3746, -3907, -4067, -4226, -4384, -4540, -4695, -4848,
		-5000, -5150, -5299, -5446, -5592, -5736, -5878, -6018, -6157, -6293,
		-6428, -6561, -6691, -6820, -6947, -7071, -7193, -7314, -7431, -7547,
		-7660, -7771, -7880, -7986, -8090, -8192, -8290, -8387, -8480, -8572,
		-8660, -8746, -8829, -8910, -8988, -9063, -9135, -9205, -9272, -9336,
		-9397, -9455, -9511, -9563, -9613, -9659, -9703, -9744, -9781, -9816,
		-9848, -9877, -9903, -9925, -9945, -9962, -9976, -9986, -9994, -9998,
		-10000, -9998, -9994, -9986, -9976, -9962, -9945, -9925, -9903, -9877,
		-9848, -9816, -9781, -9744, -9703, -9659, -9613, -9563, -9511, -9455,
		-9397, -9336, -9272, -9205, -9135, -9063, -8988, -8910, -8829, -8746,
		-8660, -8572, -8480, -8387, -8290, -8192, -8090, -7986, -7880, -7771,
		-7660, -7547, -7431, -7314, -7193, -7071, -6947, -6820, -6691, -6561,
		-6428, -6293, -6157, -6018, -5878, -5736, -5592, -5446, -5299, -5150,
		-5000, -4848, -4695, -4540, -4384, -4226, -4067, -3907, -3746, -3584,
		-3420, -3256, -3090, -2924, -2756, -2588, -2419, -2250, -2079, -1908,
		-1736, -1564, -1392, -1219, -1045, -872, -698, -523, -349, -175 };

/******************************************************************************
 * Functions
 ******************************************************************************/
uint16_t ledQB_sqrt(uint16_t a_nInput) {
	uint16_t op = a_nInput;
	uint16_t res = 0;
	uint16_t one = 1uL << 14; // The second-to-top bit is set: use 1u << 14 for uint16_t type; use 1uL<<30 for uint32_t type

	// "one" starts at the highest power of four <= than the argument.
	while (one > op) {
		one = one >> 2;
	}

	while (one != 0) {
		if (op >= res + one) {
			op = op - (res + one);
			res = res + 2 * one;
		}
		res = res >> 1;
		one = one >> 2;
	}
	return res;
}

